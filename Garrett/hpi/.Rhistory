#
new_duration <- function (months, seconds){#
	structure(data.frame(months, seconds), class = c("duration", "data.frame"))#
}#
#
#
as.duration <- function (x, ...) UseMethod("as.duration")#
#
as.duration.data.frame <- function(x, ...){#
	stopifnot(dim(x) == c(1,2))#
	x <- structure(x, class = c("duration", "data.frame"))#
	x#
}#
#
as.duration.difftime <- function(x, ...){#
	new_duration(0, as.numeric(x, units = "secs"))#
}#
#
as.duration.default <- function(x, ...){#
	warning("Numeric coerced to seconds")#
	new_duration(0,x)#
}#
#
seconds <- function(x = 1) new_duration(0, x)#
minutes <- function(x = 1) seconds(x * 60)#
hours <-   function(x = 1) minutes(x * 60)#
days <-    function(x = 1) hours(x * 24)	#
weeks <-   function(x = 1) days(x * 7)#
months <-  function(x = 1) new_duration(x, 0)#
years <-   function(x = 1) months(x * 12)#
#
y <- years(1)#
m <- months(1)#
d <- days(1)#
#
#
is.duration <- function(x) inherits(x, "duration")#
is.POSIXt <- function(x) inherits(x, "POSIXt")#
#
# adding #
"+.duration" <- "+.POSIXt" <- "+.difftime" <- function(e1, e2){#
	if(!is.POSIXt(e1) && is.duration(e2)) e1 <- as.duration(e1)#
	if(!is.POSIXt(e2) && is.duration(e1)) e2 <- as.duration(e2)#
	if (is.duration(e1) && is.duration(e2)) #
		add_duration_to_duration(e1, e2)#
	else if (is.duration(e1) && is.POSIXt(e2))#
		add_duration_to_date(e2, e1)#
	else if (is.duration(e2) && is.POSIXt(e1)) #
		add_duration_to_date(e1, e2)#
	else #
		base::'Ops.difftime'(e1, e2)#
}	#
#
add_duration_to_date <- function(date, dur) {#
	second(date) <- second(date) + dur$seconds#
	month(date) <- month(date) + dur$months#
	date#
}#
#
add_duration_to_duration <- function(dur1, dur2) {#
  dur1$seconds <- dur1$seconds + dur2$seconds#
  dur1$months <- dur1$months + dur2$months#
  dur1#
}
x + x
"+.duration" <- "+.POSIXt" <- "+" <- function(e1, e2){#
	if(!is.POSIXt(e1) && is.duration(e2)) e1 <- as.duration(e1)#
	if(!is.POSIXt(e2) && is.duration(e1)) e2 <- as.duration(e2)#
	if (is.duration(e1) && is.duration(e2)) #
		add_duration_to_duration(e1, e2)#
	else if (is.duration(e1) && is.POSIXt(e2))#
		add_duration_to_date(e2, e1)#
	else if (is.duration(e2) && is.POSIXt(e1)) #
		add_duration_to_date(e1, e2)#
	else #
		base::'Ops.difftime'(e1, e2)#
}
x + x
'+.Generic'
"+.duration" <- "+.POSIXt" <- "+" <- function(e1, e2){#
	if(!is.POSIXt(e1) && is.duration(e2)) e1 <- as.duration(e1)#
	if(!is.POSIXt(e2) && is.duration(e1)) e2 <- as.duration(e2)#
	if (is.duration(e1) && is.duration(e2)) #
		add_duration_to_duration(e1, e2)#
	else if (is.duration(e1) && is.POSIXt(e2))#
		add_duration_to_date(e2, e1)#
	else if (is.duration(e2) && is.POSIXt(e1)) #
		add_duration_to_date(e1, e2)#
	else {#
		.Generic <- '+'#
		base::'Ops.difftime'(e1, e2)#
	}#
}
x + x
		'.Generic' <- '+'
"+.duration" <- "+.POSIXt" <- "+" <- function(e1, e2){#
	if(!is.POSIXt(e1) && is.duration(e2)) e1 <- as.duration(e1)#
	if(!is.POSIXt(e2) && is.duration(e1)) e2 <- as.duration(e2)#
	if (is.duration(e1) && is.duration(e2)) #
		add_duration_to_duration(e1, e2)#
	else if (is.duration(e1) && is.POSIXt(e2))#
		add_duration_to_date(e2, e1)#
	else if (is.duration(e2) && is.POSIXt(e1)) #
		add_duration_to_date(e1, e2)#
	else {#
		'.Generic' <- '+'#
		base::'Ops.difftime'(e1, e2)#
	}#
}
x + x
rm('.Generic,)
'
>
rm('.Generic')
x + x
"+.duration" <- "+.POSIXt" <- "+" <- function(e1, e2){#
	if(!is.POSIXt(e1) && is.duration(e2)) e1 <- as.duration(e1)#
	if(!is.POSIXt(e2) && is.duration(e1)) e2 <- as.duration(e2)#
	if (is.duration(e1) && is.duration(e2)) #
		add_duration_to_duration(e1, e2)#
	else if (is.duration(e1) && is.POSIXt(e2))#
		add_duration_to_date(e2, e1)#
	else if (is.duration(e2) && is.POSIXt(e1)) #
		add_duration_to_date(e1, e2)#
	else {#
		base::'+'(e1, e2)#
	}#
}
x + x
base::'+'(x,x)
rm('+.duration')
base::'+'(x,x)
?options
traceback()
recover()
options(error = recover)
1
c
list.files
list.files()
try
base::try
rm(try)
try
return <- function(x) x
hpi <- read.csv(file.choose(), header = T)
hpi$time <- hpi$year + hpi$quarter/4#
hpi <- na.omit(hpi)#
#
#
get_max <- function(df){#
	hpi2009 <- df$hpi[df$time == 2009]#
	df <- df[df$hpi == max(df$hpi),]#
	df$change <- hpi2009 - df$hpi#
	df#
} #
#
maxhpi <- ddply(hpi, .(fips_msa), get_max)#
maxhpi <- maxhpi[,c(1,2,3,6,8,9)]#
names(maxhpi)[3] <- "cbsa"
library(plyr)
maxhpi <- ddply(hpi, .(fips_msa), get_max)#
maxhpi <- maxhpi[,c(1,2,3,6,8,9)]#
names(maxhpi)[3] <- "cbsa"
lnoutcome <- qplot(data = maxhpi, hpi, log(per_rate), colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
library(ggplot2)
#
maxhpi$rate <- with(maxhpi,change/(2009.25 - time))#
maxhpi <- within(maxhpi, per_change <- change/hpi)#
maxhpi <- within(maxhpi, per_rate <- rate / hpi)#
maxhpi <- within(maxhpi, state <- as.character(state))#
for (i in 1:nrow(maxhpi))#
	maxhpi$state[i] <- trim(gsub("MSAD", "", maxhpi$state[i]))
for (i in 1:nrow(maxhpi))#
	maxhpi$state[i] <- trim(gsub("MSAD", "", maxhpi$state[i]))
library(R.oo)
for (i in 1:nrow(maxhpi))#
	maxhpi$state[i] <- trim(gsub("MSAD", "", maxhpi$state[i]))
lnoutcome <- qplot(data = maxhpi, hpi, log(per_rate), colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
lnoutcome
log(0)
head(maxhpi)
qplot(data = maxhpi, hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
FLoutcome <- qplot(data = maxhpi[maxhpi$state == "FL",], hpi, log(per_rate), colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
FLoutcome <- qplot(data = maxhpi[maxhpi$state == "FL",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
ggsave(file="exports/outcome-by-max-price.pdf", width=8, height=6)
ggsave(file="exports/outcome-by-max-price.pdf", width=6, height=6)
FLoutcome <- qplot(data = maxhpi[maxhpi$state == "FL",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
savePlot <- function(..., plot= TRUE, big = TRUE)#
{#
nameOfPlot <- substitute(...)#
nameOfPlot <- gsub("_", "-", nameOfPlot)#
cat("\nPrinting plot ", nameOfPlot,".pdf in folder 'exports'", sep ="")#
if(plot)#
if(big)#
ggsave(..., file=paste("exports/", nameOfPlot,"_BIG.pdf",sep = "", collapse = ""), width=20, height=15) #
else#
ggsave(..., file=paste("exports/", nameOfPlot,".pdf",sep = "", collapse = ""), width=8, height=6)#
else#
cat("\nJust Kidding!!!\n")#
cat("\n")#
}
savePlot(FLoutcome)
FLoutcome
CAoutcome <- qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
CAoutcome#
savePlot(CAoutcome)
convert <- read.csv(file.choose(), header = T)
head(convert)
summary(convert)
convert <- read.csv(file.choose(), header = T)
head(convert)
convert <- read.csv(file.choose(), header = T)
head(convert)
convert <- convert[-1,c(3,6)]
head(convert)
summary(convert)
convert <- as.numeric(convert)
convert[,c(1,2)] <- as.numeric(convert[,c(1,2)])
convert$cbsa <- as.numeric(convert$cbsa)
convert$pop2k <- as.numeric(convert$pop2k)
head(maxhpi)
str(maxhpi)
str(convert)
try <- merge(maxhpi, convert, by = "cbsa")
dim(maxhpi)
dim(try)
head(convert)
convert <- read.csv(file.choose(), header = T)
convert <- convert[-1,c(3,6)]
str(convert)
options(stringsAsFactor = F)
convert <- read.csv(file.choose(), header = T)
convert <- convert[-1,c(3,6)]
str(convert)
options(stringsAsFactors = F)
convert <- read.csv(file.choose(), header = T)
str(convert)
convert <- convert[-1,c(3,6)]
convert$cbsa <- as.numeric(convert$cbsa)#
convert$pop2k <- as.numeric(convert$pop2k)
head(convert)
try <- merge(maxhpi, convert, by = "cbsa")
dim(try)
dim(maxhpi)
pop <- read.csv(file.choose(), header = T)
head(pop)
pop2 <- read.csv(file.choose(), header = T)
head(pop2)
convert <- read.csv(file.choose(), header = T)
head(convert)
summary(convert)
str(convert)
convert <- read.csv(file.choose(), header = T)
head(convert)
str(convert)
pop <- read.csv(file.choose(), header = T)
head(pop)
pop <- pop[-c(1,2),c(1,3)]
head(pop)
str(pop)
pop$cbsa <- as.numeric(pop$cbsa)#
pop$pop2k <- as.numeric(pop$pop2k)
try <- merge(maxhpi, pop, by = "cbsa")
dim(try)
dim(maxhpi)
head(try)
maxhpi <- merge(maxhpi, pop, by = "cbsa", all.x = T)
savePlot(CAoutcome)
qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, geom = "text", size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
CAoutcome_hpi <- qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, geom = "text", label = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
qplot(data = maxhpi[maxhpi$state == "FL",], hpi, per_rate, colour = state, geom = "text", label = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
AZoutcome <- qplot(data = maxhpi[maxhpi$state == "AZ",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
AZoutcome
savePlot(AZoutcome)
qplot(data = maxhpi[maxhpi$state == "AZ",], hpi, per_rate, colour = state, geom = "text", label = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL"),], hpi, per_rate, colour = state, geom = "text", label = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL"),], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV"),], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
FCAoutcome <- qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV"),], hpi, per_rate, colour = state, size = pop2k, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
FCAoutcome
NVoutcome <- qplot(data = maxhpi[maxhpi$state == "NV",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
NVoutcome#
savePlot(NVoutcome)
qplot(data = maxhpi[maxhpi$state == "OR",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR", "GA"),], hpi, per_rate, colour = state, size = pop2k, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, colour = state, size = pop2k, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap(format = ~ state)
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, colour = state, size = pop2k, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)
FCAoutcome <- qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, colour = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)
FCAoutcome
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR", "TX"),], hpi, per_rate, colour = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "OR"),], hpi, per_rate, colour = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, colour = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)#
FCANoutcomes
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, geom = "text", label = state, colour = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)
FCANoutcomes <- qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, geom = "text", label = state, colour = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)#
FCANoutcomes#
savePlot(FCANoutcomes)
qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, geom = "text", label = state, colour = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)
FLoutcome <- qplot(data = maxhpi[maxhpi$state == "FL",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
savePlot(FLoutcome)
CAoutcome <- qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
CAoutcome#
savePlot(CAoutcome)
AZoutcome <- qplot(data = maxhpi[maxhpi$state == "AZ",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
AZoutcome#
savePlot(AZoutcome)
NVoutcome <- qplot(data = maxhpi[maxhpi$state == "NV",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
NVoutcome#
savePlot(NVoutcome)
FCANoutcomes <- qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, geom = "text", label = state, colour = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)#
FCANoutcomes#
savePlot(FCANoutcomes)
savePlot <- function(..., plot= TRUE, big = FALSE)#
{#
nameOfPlot <- substitute(...)#
nameOfPlot <- gsub("_", "-", nameOfPlot)#
cat("\nPrinting plot ", nameOfPlot,".pdf in folder 'exports'", sep ="")#
if(plot)#
if(big)#
ggsave(..., file=paste("exports/", nameOfPlot,"-BIG.pdf",sep = "", collapse = ""), width=20, height=15) #
else#
ggsave(..., file=paste("exports/", nameOfPlot,".pdf",sep = "", collapse = ""), width=8, height=6)#
else#
cat("\nJust Kidding!!!\n")#
cat("\n")#
}
#
FLoutcome <- qplot(data = maxhpi[maxhpi$state == "FL",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
savePlot(FLoutcome)
CAoutcome <- qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
CAoutcome#
savePlot(CAoutcome)
AZoutcome <- qplot(data = maxhpi[maxhpi$state == "AZ",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
AZoutcome#
savePlot(AZoutcome)
NVoutcome <- qplot(data = maxhpi[maxhpi$state == "NV",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
NVoutcome#
savePlot(NVoutcome)
#
FCANoutcomes <- qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, geom = "text", label = state, colour = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)#
FCANoutcomes#
savePlot(FCANoutcomes)
head(maxhpi)
qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, geom = "text", label = city, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
savePlot(CAcityoutcome, big = T)
#
CAcityoutcome <- qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, geom = "text", label = city, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
CAcityoutcome
savePlot(CAcityoutcome, big = T)
location <- read.csv("loc-cbsa.csv", header = T)
head(location)
str(location)
location <- location[-c(1,2), c(1,3,4)]
location
head(location)
names(location) <- c("cbsa", "longitude", "latitude")
str(location)
location$longitude <- as.numeric(location$longitude)#
location$latitude <- as.numeric(location$latitude)
try <- merge(maxhpi, location, by = "cbsa")
dim(try)
hpi <- merge(maxhpi, location, by = "cbsa", all.x = T)
qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, size = latitude, geom = "text", label = city, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
maxhpi <- merge(maxhpi, location, by = "cbsa", all.x = T)
qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, size = latitude, geom = "text", label = city, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
calhpi <-maxhpi[maxhpi$state == "CA",]
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] >= 36.14)#
		calhpi$n_or_s[i] <- "n"#
	else#
		calhpi$n_or_s[i] <- "s"#
}
traceback()
head(calhpi)
calhpi <-na.omit(maxhpi[maxhpi$state == "CA",])
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] >= 36.14)#
		calhpi$n_or_s[i] <- "n"#
	else#
		calhpi$n_or_s[i] <- "s"#
}
head(calhpi)
qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = n_or_s, size = latitude, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
qplot(data = calhpi, hpi, per_rate, colour = n_or_s, size = latitude, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
qplot(data = calhpi, hpi, per_rate, colour = n_or_s, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
qplot(data = calhpi, hpi, per_rate, colour = n_or_s,  main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
dim(calhpi)
dim(maxhpi[maxhpi$state == "CA",])
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] <= 36.14 && calhpi$longitude[i] <= -121.768)#
		calhpi$n_or_s[i] <- "bay_area"#
	else if (calhpi$latitude[i]<= 35.38)#
		calhpi$n_or_s[i] <- "so_cal"#
	else#
		calhpi$n_or_s[i] <- "other"#
}
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] >= 36.14)#
		calhpi$n_or_s[i] <- "n"#
	else#
		calhpi$n_or_s[i] <- "s"#
}#
#
#
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] <= 36.14 && calhpi$longitude[i] <= -121.768)#
		calhpi$region[i] <- "bay_area"#
	else if (calhpi$latitude[i]<= 35.38)#
		calhpi$region[i] <- "so_cal"#
	else#
		calhpi$region[i] <- "other"#
}
head(calhpi)
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") #
+ opts(legend.position = "none")
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
calhpi
maxhpi[maxhpi$state == "CA",]
try <- rbind(calhpi, maxhpi[210,])
Irvine <- maxhpi[319,]#
Irvine$latitude <- 33.67#
Irvine$longitude <- -117.88#
Irvine$n_or_s <- "s"#
Irvine$region <- "so_cal"
Irvine
LA <- maxhpi[210,]#
LA$latitude <- 33.93#
LA$longitude <- -118.40#
LA$n_or_s <- "s"#
LA$region <- "so_cal"#
#
SanFran <- maxhpi[316,]#
SanFran$latitude <- 37.75#
SanFran$longitude <- -122.68#
SanFran$n_or_s <- "n"#
SanFran$region <- "no_cal"#
#
Oakland <- maxhpi[252,]#
Oakland$latitude <- 37.73#
Oakland$longitude <- -122.22#
Oakland$n_or_s <- "n"#
Oakland$region <- "no_cal"#
#
Irvine <- maxhpi[319,]#
Irvine$latitude <- 33.67#
Irvine$longitude <- -117.88#
Irvine$n_or_s <- "s"#
Irvine$region <- "so_cal"
calhpi <- rbind(calhpi, LA, SanFran, Oakland, Irvine)
calhpi
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") #
+ opts(legend.position = "none")
calhpi <-na.omit(maxhpi[maxhpi$state == "CA",])#
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] >= 36.14)#
		calhpi$n_or_s[i] <- "n"#
	else#
		calhpi$n_or_s[i] <- "s"#
}#
#
#
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] <= 36.14 && calhpi$longitude[i] <= -121.768)#
		calhpi$region[i] <- "bay_area"#
	else if (calhpi$latitude[i]<= 35.38)#
		calhpi$region[i] <- "so_cal"#
	else#
		calhpi$region[i] <- "other"#
}#
#
LA <- maxhpi[210,]#
LA$latitude <- 33.93#
LA$longitude <- -118.40#
LA$n_or_s <- "s"#
LA$region <- "so_cal"#
#
SanFran <- maxhpi[316,]#
SanFran$latitude <- 37.75#
SanFran$longitude <- -122.68#
SanFran$n_or_s <- "n"#
SanFran$region <- "bay_area"#
#
Oakland <- maxhpi[252,]#
Oakland$latitude <- 37.73#
Oakland$longitude <- -122.22#
Oakland$n_or_s <- "n"#
Oakland$region <- "bay_area"#
#
Irvine <- maxhpi[319,]#
Irvine$latitude <- 33.67#
Irvine$longitude <- -117.88#
Irvine$n_or_s <- "s"#
Irvine$region <- "so_cal"#
#
calhpi <- rbind(calhpi, LA, SanFran, Oakland, Irvine)
dim(calhpi)
calhpi
calhpi[9,14] <- "bay_area"
calhpi
calhpi[c(9, 14, 16, 19, 20),14] <- "bay_area"
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] <= 36.14 & calhpi$longitude[i] <= -121.768)#
		calhpi$region[i] <- "bay_area"#
	else if (calhpi$latitude[i]<= 35.38)#
		calhpi$region[i] <- "so_cal"#
	else#
		calhpi$region[i] <- "other"#
}
calhpi
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] <= 36.14 & calhpi$longitude[i] >= -121.768)#
		calhpi$region[i] <- "bay_area"#
	else if (calhpi$latitude[i]<= 35.38)#
		calhpi$region[i] <- "so_cal"#
	else#
		calhpi$region[i] <- "other"#
}
calhpi
#
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] <= 39.14 & calhpi$longitude[i] <= -121.768)#
		calhpi$region[i] <- "bay_area"#
	else if (calhpi$latitude[i]<= 35.38)#
		calhpi$region[i] <- "so_cal"#
	else#
		calhpi$region[i] <- "other"#
}
calhpi
for (i in 1:nrow(calhpi)){#
	if (calhpi$latitude[i] <= 36.14 & calhpi$longitude[i] <= -121.768)#
		calhpi$region[i] <- "bay_area"#
	else if (calhpi$latitude[i]<= 35.38)#
		calhpi$region[i] <- "so_cal"#
	else#
		calhpi$region[i] <- "other"#
}
calhpi[c(9, 14, 16, 19, 20),14] <- "bay_area"
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") #
+ opts(legend.position = "none")
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", geom = "text", label = city, ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
calhpi
dim(calhpi)
calhpi[c(9, 14, 16, 19, 20, 26, 27),14] <- "bay_area"
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", geom = "text", label = city, ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
calhpi$region <- c("central valley",#
					"central valley",#
					"southern desert",#
					"central valley",#
					"central valley",#
					"central valley",#
					"central valley",#
					"central valley",#
					"bay area",#
					"so cal",#
					"north cal",#
					"southern desert",#
					"central valley",#
					"bay area",#
					"so cal",#
					"bay area",#
					"so cal",#
					"so cal",#
					"bay area",#
					"bay area",#
					"central valley",#
					"bay area",#
					"central valley",#
					"central valley",#
					"so cal",#
					"bay area",#
					"bay area",#
					"so cal")
head(calhpi)
calhpi
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", geom = "text", label = city, ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
calhpi$region <- c("central valley",#
					"central valley",#
					"southern desert",#
					"central valley",#
					"central valley",#
					"central valley",#
					"central valley",#
					"central valley",#
					"bay area",#
					"so cal",#
					"central valley",#
					"so cal",#
					"central valley",#
					"bay area",#
					"so cal",#
					"bay area",#
					"so cal",#
					"so cal",#
					"bay area",#
					"bay area",#
					"central valley",#
					"bay area",#
					"central valley",#
					"central valley",#
					"so cal",#
					"bay area",#
					"bay area",#
					"so cal")
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", geom = "text", label = city,ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
CalByRegion <- qplot(data = calhpi, hpi, per_rate, colour = region,  main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") #
CalByRegion#
savePlot(CalByRegion)
CalByRegion <- qplot(data = calhpi, hpi, per_rate, colour = region,  main = "California Max HPI by region vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") #
CalByRegion#
savePlot(CalByRegion)
NVoutcome <- qplot(data = maxhpi[maxhpi$state == "NV",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Nevada Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
NVoutcome#
savePlot(NVoutcome)
AZoutcome <- qplot(data = maxhpi[maxhpi$state == "AZ",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Arizona Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
AZoutcome#
savePlot(AZoutcome)
CAoutcome <- qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, colour = state, geom = "text", label = state, main = "California Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
CAoutcome#
savePlot(CAoutcome)
qplot(data = calhpi, hpi, per_rate, colour = region,  geom = "text", label = state,main = "California Max HPI by region vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)")
CalByRegion#
savePlot(CalByRegion)
CalByRegion <- qplot(data = calhpi, hpi, per_rate, colour = region,  geom = "text", label = state,main = "California Max HPI by region vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") #
CalByRegion#
savePlot(CalByRegion)
FLoutcome <- qplot(data = maxhpi[maxhpi$state == "FL",], hpi, per_rate, colour = state, geom = "text", label = state, main = "Florida Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
savePlot(FLoutcome)
FLoutcome
qplot(data = maxhpi[maxhpi$state == "FL",], hpi, per_rate, geom = "text", label = state, main = "Florida Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")
FLoutcome <- qplot(data = maxhpi[maxhpi$state == "FL",], hpi, per_rate, geom = "text", label = state, main = "Florida Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
FLoutcome#
savePlot(FLoutcome)
CAoutcome <- qplot(data = maxhpi[maxhpi$state == "CA",], hpi, per_rate, geom = "text", label = state, main = "California Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
CAoutcome#
savePlot(CAoutcome)
AZoutcome <- qplot(data = maxhpi[maxhpi$state == "AZ",], hpi, per_rate,  geom = "text", label = state, main = "Arizona Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
AZoutcome#
savePlot(AZoutcome)
NVoutcome <- qplot(data = maxhpi[maxhpi$state == "NV",], hpi, per_rate, geom = "text", label = state, main = "Nevada Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none")#
NVoutcome#
savePlot(NVoutcome)
FCANoutcomes <- qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, geom = "text", label = state, colour = state, size = pop2k, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)#
FCANoutcomes#
savePlot(FCANoutcomes)
FCANoutcomes <- qplot(data = maxhpi[maxhpi$state %in% c("AZ", "CA", "FL", "NV", "OR"),], hpi, per_rate, geom = "text", label = state, colour = state, main = "Max HPI vs. outcome", ylab = "Rate of change per year (as percentage of max HPI)", xlab = "Maximum HPI (2005-2009)") + opts(legend.position = "none") + facet_wrap( ~ state)#
FCANoutcomes#
savePlot(FCANoutcomes)
CalByRegion
