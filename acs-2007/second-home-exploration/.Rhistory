str(convert)
options(stringsAsFactors = FALSE)
convert <- read.csv(file.choose(), header = T)
names(convert)[c(1,2)] <- c("fips_st", "fips_puma")
str(convert)
convert$fips_st <- as.numeric(convert$fips_st)
convert$fips_puma <- as.numeric(convet$fips_puma)
convert$fips_puma <- as.numeric(convert$fips_puma)
summary(convert)
try <- merge(shomes, convert, by = c("fips_st", "fips_puma"))
dim(try)
head(try)
shomes <- merge(shomes, convert, by = c("fips_st", "fips_puma"))
hpi <- read.csv(file.choose(), headers = T)
hpi <- read.csv(file.choose(), header = T)
head(hpi)
shomes[shomes$cbsa == 22520,]
shomes[shomes$cbsa == 10180,]
try <- hpi[hpi$year %in% c(2005, 2006, 2007),]
dim(try)
head(try)
try[1:20,]
hpi <- hpi[hpi$year %in% c(2005, 2006, 2007),]
names(hpi)[3] <- "cbsa"
head(hpi)
try <- merge(shomes, hpi, by = "cbsa")
dim(try)
head(try)
try <- merge(shomes, hpi, by = c("cbsa", "year"))
head(try)
head(shomes)
head(hpi)
hpi$time <- hpi$year + (hpi$quarter - 1) / 4#
hpi$year <- hpi$quarter <- NULL#
#
#
shomes$time <- shomes$year#
shomes$year <- NULL
try <- merge(shomes, hpi, by = c("cbsa", "year"))
try <- merge(shomes, hpi, by = c("cbsa", "time"))
head(try)
try <- merge(shomes, hpi, by = c("cbsa"))
head(try)
source("explore.r")
head(shomes)
head(hpi)
shomes$year <- shomes$time
hpi <- read.csv(file.choose(), header = T)#
hpi <- hpi[hpi$year %in% c(2005, 2006, 2007),]#
names(hpi)[3] <- "cbsa"
hpi <- read.csv(file.choose(), header = T)#
hpi <- hpi[hpi$year %in% c(2005, 2006, 2007),]#
names(hpi)[3] <- "cbsa"
head(hpi)
hpi$time <- hpi$year + (hpi$quarter - 1) / 4
head(hpi)
head(shomes)
shomes <- merge(shomes, convert, by = c("fips_st", "fips_puma"))
head(shomes)
shomes <- read.csv("data/shomes.csv", header = T)
shomes <- merge(shomes, convert, by = c("fips_st", "fips_puma"))
head(shomes)
head(shomes)
shomes$time <- shomes$year
head(shomes)
shomes$year <- NULL
shomes$year <- shomes$time
head(shomes)
hpi$time <- hpi$year + (hpi$quarter - 1) / 4#
hpi$year <- hpi$quarter <- NULL#
#
h <- hpi[,c("cbsa", "time", "hpi")]#
s <- shomes[,c("cbsa", "time", "per_owner")]
head(h)
head(s)
h <- merge(h, convert, by = "cbsa")
head(h)
library(plyr)
by_puma <- function(df){#
	portion <- df$afact * df$hpi#
 	sum(portion)#
}#
#
new <- ddply(h, .(fips_st, fips_puma, time), by_puma)
str(h)
str(hpi)
h$afact <- as.numeric(h$afact)
new <- ddply(h, .(fips_st, fips_puma, time), by_puma)
head(new)
by_puma <- function(df){#
	portion <- df$afact * df$hpi#
 	c(hpi = sum(portion))#
}
new <- ddply(h, .(fips_st, fips_puma, time), by_puma)
head(new)
h <- new
s <- shomes[,c("fips_st", "fips_puma", "time", "per_owner")]
head(s)
dim(h)
dim(s)
plot <- ggplot(data = s, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = h, aes(x = time, y = hpi)) + facet_wrap(~cbsa)#
#
plot
hfl <- h[h$fips_st == 12,]
sfl <- s[s$fips_st == 12,]
plot <- ggplot(data = sfl, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl, aes(x = time, y = hpi)) + facet_wrap(~ fips_puma)#
#
plot
hfl2 <- h[h$fips_st == 12 & h$fips_puma == 3702]
hfl2 <- h[h$fips_st == 12 & h$fips_puma == 3702,]
sfl2 <- s[s$fips_st == 12 & s$fips_puma == 3702,]
plot <- ggplot(data = sfl2, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl2, aes(x = time, y = hpi))
plot
sfl2
plot <- ggplot(data = s, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = h, aes(x = time, y = hpi)) + facet_wrap(~cbsa, scales = "free")
plot <- ggplot(data = sfl, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl, aes(x = time, y = hpi), colour = I("red")) + facet_wrap(~ fips_puma, scales = "free")
plot
sfl2 <- s[s$fips_st == 12 & s$fips_puma <= 2000,]
dim(sfl2)
sfl2 <- s[s$fips_st == 12 & s$fips_puma <= 1000,]
dim(sfl2)
hfl2 <- h[h$fips_st == 12 & h$fips_puma == 1000,]
ggplot(data = sfl2, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl2, aes(x = time, y = hpi), colour = I("red")) + facet_wrap(~ fips_puma, scales = "free")
ggplot(data = sfl2, aes(x = time)) + geom_line(aes(y = per_owner)) +  facet_wrap(~ fips_puma, scales = "free")
ggplot(data = sfl2, aes(x = time)) + geom_line(data = hfl2, aes(x = time, y = hpi), colour = I("red")) + facet_wrap(~ fips_puma, scales = "free")
ggplot(data = sfl2, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl2, aes(x = time, y = hpi)) + facet_wrap(~ fips_puma, scales = "free")
ggplot(data = sfl2, aes(x = time)) + geom_line(data = hfl2, aes(x = time, y = hpi), colour = I("red")) + facet_wrap(~ fips_puma, scales = "free")
ggplot(data = sfl2, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl2, aes(x = time, y = hpi), colour = I("red")) + facet_wrap(~ fips_puma, scales = "free")
head(hf12)
head(hfl2)
hfl2 <- h[h$fips_st == 12 & h$fips_puma <= 1000,]
ggplot(data = sfl2, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl2, aes(x = time, y = hpi), colour = I("red")) + facet_wrap(~ fips_puma, scales = "free")
bigPlot <- ggplot(data = sfl, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl, aes(x = time, y = hpi), colour = I("red")) + facet_wrap(~ fips_puma, scales = "free")
savePlot(bigPlot, plot = TRUE)
ggplot(data = sfl2, aes(x = time)) + geom_line(aes(y = per_owner)) + geom_line(data = hfl2, aes(x = time, y = hpi), colour = I("red")) + facet_wrap(~ fips_puma, scales = "free")
qplot(x = time, y = per_owner, data = sfl2, geom = "line") + geom_line(data = hfl2, aes(y = hpi / max(hpi) * range(per_owner)), colour = I("red"))
qplot(x = time, y = per_owner, data = sfl2, geom = "line") + geom_line(data = hfl2, aes(y = hpi / max(hpi) * range(y)), colour = I("red"))
qplot(x = time, y = per_owner, data = sfl2, geom = "line") + geom_line(data = hfl2, aes(y = hpi / max(hpi) * range(20) + 70), colour = I("red"))
qplot(x = time, y = per_owner, data = sfl2, geom = "line") + geom_line(data = hfl2, aes(y = hpi / max(hpi) * range(20) + 70), colour = I("red")) + facet_wrap(~fips_puma)
head(h)
h[1:10,]
h[1:15,]
hpi <- read.csv(file.choose(), header = T)
summary(hpi)
hpi$time <- hpi$year + (hpi$quarter - 1) / 4
hpi$year <- hpi$quarter <- NULL
summary(hpi)
head(hpi)
names(hpi)[3] <- "cbsa"
h <- hpi[,c("cbsa", "time", "hpi")]
h <- merge(h, convert, by = "cbsa")
h$afact <- as.numeric(h$afact)
by_puma <- function(df){#
	portion <- df$afact * df$hpi#
 	c(hpi = sum(portion))#
}#
#
h <- ddply(h, .(fips_st, fips_puma, time), by_puma)
get_change <- function(df){#
	max_hpi <- max(df$hpi)#
	last_hpi <- df[df$time == 2009,4]#
	change <- last_hpi - max_hpi#
	c(change = change)#
}
head(h)
get_change <- function(df){#
	max_hpi <- max(df$hpi)#
	last_hpi <- df[df$time == 2009,4]#
	time = df[df$hpi == max_hpi,3]#
	change <- last_hpi - max_hpi#
	c(change = change, #
		max = max_hpi,#
		time = time,#
		rate = change / time)#
}
get_change(head(h))
hdata <- ddply(h, .(fips_st, fips_puma), get_change)
traceback()
dim(unique(h[,c(1,2)]))
dim(h[h$time == 2009,])
get_change <- function(df){#
	max_hpi <- max(df$hpi)#
	last_hpi <- df[df$time == 2009,4]#
	time = df[df$hpi == max_hpi,3]#
	change <- last_hpi - max_hpi#
	c(change1 = change, #
		max1 = max_hpi,#
		time1 = time,#
		rate1 = change / time)#
}
hdata <- ddply(h, .(fips_st, fips_puma), get_change)
df <- h[h$fips_st == 1 & h$fips_puma == 100,]
df
max(df$hpi)
	max_hpi <- max(df$hpi)
df[df$time == 2009,4]
	last_hpi <- df[df$time == 2009,4]
df[df$hpi == max_hpi,3]
	time = df[df$hpi == max_hpi,3]
	change <- last_hpi - max_hpi
	c(change = change, #
		max = max_hpi,#
		time = time,#
		rate = change / time)
df <- h[h$fips_st == 6 & h$fips_puma == 100,]
df
df <- h[h$fips_st == 6 & h$fips_puma == 1000,]
df
max_hpi <- max(df$hpi)#
	last_hpi <- df[df$time == 2009,4]#
	time = df[df$hpi == max_hpi,3]#
	change <- last_hpi - max_hpi#
	c(change = change, #
		max = max_hpi,#
		time = time,#
		rate = change / time)
summary(h)
hdata <- ddply(na.omit(h), .(fips_st, fips_puma), get_change)
dim(hdata)
head(hdata)
head(s)
s2007 <- s[s$time == 2007,]
try <- merge(hdata, s2007, by = c("fips_st", "fips_puma"))
dim(try)
dim(hdata)
dim(s2007)
dim(convert)
dim(h)
head(try)
?merge
s2006 <- s[s$time == 2006,]
try <- merge(hdata, s2006, by = c("fips_st", "fips_puma"))
dim(try)
summary(try)
dim(unique(s2600[,c(1,2)]))
dim(unique(s2006[,c(1,2)]))
head(s2006)
dim(unique(hdata[,c(1,2)]))
dim(unique(try[,c(1,2)]))
get_change <- function(df){#
	max_hpi <- max(df$hpi)#
	last_hpi <- df[df$time == 2009,4]#
	time = df[df$hpi == max_hpi,3]#
	change <- last_hpi - max_hpi#
	c(change = change, #
		max = max_hpi,#
		time = time,#
		rate = change / time)#
}
hdata <- ddply(na.omit(h), .(fips_st, fips_puma), get_change)
dim(unique(hdata[,c(1,2)]))
dim(unique(s[,c(1,2)]))
head(hdata0
)
head(hdata)
head(s)
head(s2006)
try <- merge(hdata, s2006, by = c("fips_st", "fips_puma"))
dim(try)
dim(hdata)
try <- merge(hdata, s2006, by = c("fips_st", "fips_puma"), all = F)
dim(try)
dim(unique(hdata[,c(1,2)]))
try
head(try)
head(s)
s2006 <- s[s$time == 2006,c(1,2,4)]
try <- merge(hdata, s2006, by = c("fips_st", "fips_puma"), all = F)
dim(try)
dim(unique(s2006[,c(1,2)]))
dim(s2006)
dim(unique(s2006))
s2006 <- unique(s[s$time == 2006,c(1,2,4)])
dim(s2006)
try <- merge(hdata, s2006, by = c("fips_st", "fips_puma"), all = F)
dim(try)
head(try)
dim(unique(try))
hdata <- merge(hdata, s2006, by = c("fips_st", "fips_puma"), all = F)
qplot(per_owner, change, data = hdata)
qplot(per_owner, rate, data = hdata)
qplot(per_owner, rate, data = hdata, color = fips_st)
qplot(per_owner, rate, data = hdata, color = "fips_st")
qplot(per_owner, rate, data = hdata, colour = fips_st)
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 30,], colour = fips_st)
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = fips_st)
for (i in 1:nrow(hdata)){#
	if (fips_st %in% c(04, 06, 12))#
		hdata$azflca <- 1#
	else#
		hdata$azflca <- 0#
}
for (i in 1:nrow(hdata)){#
	if (hdata$fips_st[i] %in% c(04, 06, 12))#
		hdata$azflca[i] <- 1#
	else#
		hdata$azflca[i] <- 0#
}
head(hdata)
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca)
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .05)
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .5)
for (i in 1:nrow(hdata)){#
	if (hdata$fips_st[i] == 04)#
		hdata$azflca[i] <- "AZ"#
	else if (hdata$fips_st[i] == 06)#
		hdata$azflca[i] <- "CA"#
	else if (hdata$fips_st[i] == 12)#
		hdata$azflca[i] <- "FL"#
	else#
		hdata$azflca[i] <- "other"#
}
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9), ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes")
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes")
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","yellow", "red", "orange"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","yellow", "red", "red orange"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","yellow", "red", "redorange"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","yellow", "red", "dark orange"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","yellow","dark orange", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","yellow","dark orange", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","orange","dark orange", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","pink","dark orange", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","maroon","dark orange", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","maroon","magenta", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","maroon","fucia", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","maroon","fuscia", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","maroon","chartruse", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","maroon","red" + 1, "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","maroon","dark orange", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("dark blue","dark yellow","dark orange", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","dark yellow","dark orange", "red"))
qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","yellow","dark orange", "red"))
rate <- qplot(per_owner, rate, data = hdata[hdata$fips_st <= 20,], colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","yellow","dark orange", "red"))
savePlot(rate)
savePlot(rate, print = TRUE)
savePlot(rate, plot = TRUE)
head(hdata)
rate <- qplot(per_owner, rate, data = hdata, colour = azflca, alpha = .9, ylab = "Rate of change in House Price Index", xlab = "Percentage of owner occupied homes") + scale_colour_manual(values = c("blue","yellow","dark orange", "red"))
rate
hdata[hdata$rate == -0.05,]
hdata[hdata$rate <= -0.04 & hdata$rate >= -0.06,]
